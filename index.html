<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="pomoicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <title>ç¶ è‰²ç•ªèŒ„é˜</title>
</head>
<style>
     :root {
        font-family: 'Noto Sans TC', sans-serif;
        font-size: 1.2rem;
    }
    
    h1 {
        position: absolute;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -30%);
        text-align: center;
        font-size: 1.2rem;
        font-weight: normal;
    }
    
    .pomoClock {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        background-color: #fff;
        z-index: 5;
        padding: 0 50px
    }
    
    .fa {
        color: #399;
        font-size: 1.8rem;
        cursor: pointer;
    }
    
    .pomoCookie {
        position: absolute;
        bottom: 0;
        padding: 0 10px;
    }
    
    .pomoCookie p span:nth-child(2) {
        padding-left: 30px;
    }
</style>

<body>
    <div id="app">
        <section>
            <h1>{{msg}}</h1>
            <div class="pomoClock">
                <p v-if="isShort">{{pomoMinute(timeShortCount)}}ï¼š {{pomoSecond(timeShortCount)}}</p>
                <p v-else>{{pomoMinute(timePomoCount)}}ï¼š {{pomoSecond(timePomoCount)}}</p>
                <!-- æš«åœ -->
                <i class="fa fa-pause-circle" aria-hidden="true" v-if="isCount" @click='countPause'></i>
                <!-- é–‹å§‹ -->
                <i class="fa fa-play-circle" aria-hidden="true" v-else @click='countDown'></i>
                <i class="fa fa-stop-circle" aria-hidden="true" v-if="isPomo" @click='countStop'></i>
            </div>
        </section>
        <footer class="pomoCookie">
            <p>
                <span>å·²æ¡æ”¶ï¼š{{timeCookie}}/4ç•ªèŒ„</span>
                <span>å·²æ”¶ç©«ï¼š{{pomotreeCookie}}æ£µç•ªèŒ„æ¨¹</span>
            </p>
        </footer>
    </div>
    </div>
</body>
<script>
    var canNotify = false

    function showNotification() {
        const notify = new Notification("æ™‚é–“åˆ°", {
            body: "ç¶ è‰²ç•ªèŒ„é—œå¿ƒæ‚¨",
            icon: "pomonoti.ico"
        })
    }
    console.log(Notification.permission)
    if (!('Notification' in window)) {
        console.log('This browser does not support notification');
    }
    switch (Notification.permission) {
        case 'default':
        case 'undefined':
            Notification.requestPermission()
            break
        case 'granted':
            canNotify = true
            break
    }
    // if (Notification.permission == "granted") showNotification()

    let app = new Vue({
        el: "#app",
        data: {
            msg: "é–‹å§‹ç†±è¡€ğŸ…å§",
            unCountMsg: "é–‹å§‹ç†±è¡€ğŸ…å§",
            pomoMsg: "\\ ç•ªèŒ„ğŸ…æ™‚å…‰ /",
            shortMsg: "å°æ­‡ç‰‡åˆ»ï¼ŒğŸ…ç†Ÿäº†æœ€å¥½åƒ",
            longMsg: "å¥½å¥½ä¼‘æ¯ï¼Œç­‰ä¸‹ä¸€æ£µç•ªèŒ„æ¨¹â€¦â€¦",
            isCount: false,
            isPomo: false,
            isShort: false,
            isLong: false,
            timeCount: 0,
            // ç•ªèŒ„æ™‚é–“
            timePomo: 5,
            timePomoCount: 5,
            //å°æ­‡
            timeShort: 3,
            timeShortCount: 3,
            //ä¼‘æ¯
            timeLong: 4,
            timeLongCount: 4,
            timeInterval: null,
            alertMusic: 'bell.mp3',
            timeCookie: 0,
            pomotreeCookie: 0
        },
        methods: {
            //å€’æ•¸è¨ˆæ™‚
            countDown: function() {
                //è¨ˆç•«è®“timeä»£å…¥Count
                // this.timePomoCount = this.timePomo
                this.msg = this.pomoMsg
                this.isCount = true
                this.isPomo = true
                this.timeInterval = setInterval(this.timeCountDowner, 1000)
            },
            countPause: function() {
                clearInterval(this.timeInterval)
                this.isCount = false
            },
            countStop: function() {
                clearInterval(this.timeInterval)
                this.timeResetter()
            },
            timeCountDowner() {
                this.timePomoCount = this.timePomoCount - 1
                if (this.timePomoCount == 0 && canNotify == true) {
                    showNotification()
                    clearInterval(this.timeInterval)
                    this.timePomoCount = 0
                    this.shortCountDown()
                }
            },
            shortCountDown: function() {
                this.msg = this.shortMsg
                this.isShort = true
                this.timeInterval = setInterval(this.shortCountDowner, 1000)
            },
            shortCountDowner() {
                this.timeShortCount = this.timeShortCount - 1
                if (this.timeShortCount < 0) {
                    showNotification()
                    clearInterval(this.timeInterval)
                    this.timeShortCount = 0
                    this.timeResetter()
                }
            },
            longCountDown: function() {
                this.msg = this.longMsg
                this.isLong = true
                this.timeInterval = setInterval(this.longCountDowner, 1000)
            },
            longCountDowner() {
                this.timeLongCount = this.timeLongCount - 1
                if (this.timeLongCount < 0) {
                    showNotification()
                    clearInterval(this.timeInterval)
                    this.timeShortCount = 0
                    this.timeResetter()
                }
            },
            timeResetter() {
                this.msg = this.unCountMsg
                this.isCount = false
                this.isPomo = false
                this.isShort = false
                this.isLong = false
                this.timePomoCount = this.timePomo
                this.timeShortCount = this.timeShort
                this.timeCookier()
            },
            timeCookier() {
                this.timeCookie++
                    if (this.timeCookie >= 4) {
                        this.timeCookie = 0
                        this.pomotreeCookie++
                    }
            },
            padZero(numVar, numLength) {
                return (Array(numLength).join("0").slice(-numLength) + numVar).slice(-numLength)
            },
            pomoMinute(time) {
                return this.padZero(Math.floor(time / 60), 2)
            },
            pomoSecond(time) {
                return this.padZero(time % 60, 2)
            }
        },
        computed: {

        }
    })
</script>

</html>